# 绪论

## 嵌入式系统

1、嵌入式系统概念：嵌入式计算机系统是以应用为中心、以计算机技术为基础、软件硬件可裁剪，同时适应应用系统对功能、可靠性、成本、体积、功耗严格要求的专用计算机系统。  
2、嵌入式系统的组成
嵌入式系统一般由嵌入式硬件和软件组成
**硬件部分**

- 处理器/微处理器
- 存储器及外设器件
- I/O端口、图形控制器等

嵌入式系统有别于一般的计算机处理系统，它不具备像硬盘那样大容量的存储介质，而大多使用EPROM、EEPROM或闪存(Flash Memory)作为存储介质。

**软件部分**

- 操作系统软件(要求实时和多任务操作)
- 应用程序编程

应用程序控制着系统的运作和行为；而操作系统控制着应用程序编程与硬件的交互作用。

3、嵌入式系统的特点  
嵌入式系统发展至今，具备了许多与通用计算机不同的特点，主要包括以下五点：

1.  系统资源受限制——即面向特定应用；
2.  具有实时约束；
3.  要求较高的可靠性和稳定性；
4.  大多数嵌入式系统要求低功耗；
5.  嵌入式系统开发需要专用工具和特殊方法。

因为嵌入式系统资源受限，一般不具备自主开发能力，产品发布后，用户通常不能对其中的软件进行修改，必须有一套专门的开发环境  
该开发环境包括专门的开发工具（包括设计、编译、调试、测试等工具），采用交叉开发的方式进行。



## 嵌入式处理器

​		嵌入式系统的核心是嵌入式微处理器。嵌入式微处理器一般具备4个特点：

1. 对实时和多任务有很强的支持能力，能完成多任务并且有较短的中断响应时间，从而使内部的代码和实时操作系统的执行时间减少到最低限度；
2. 具有功能很强的存储区保护功能，这是由于嵌入式系统的软件结构已模块化，而为了避免在软件模块之间出现错误的交叉作用，需要设计强大的存储区保护功能，同时也有利于软件诊断；
3. 可扩展的处理器结构，以能迅速地扩展出满足应用的高性能的嵌入式微处理器；
4. 嵌入式微处理器的功耗必须很低，尤其是用于便携式的无线及移动的计算和通信设备中靠电池供电的嵌入式系统更是如此，功耗只能为mW甚至μW级。

>  		据不完全统计，目前全世界嵌入式处理器的品种总量已经超过1000种，流行的体系结构有30多个系列。其中8051体系占多半，生产这种单片机的半导体厂家有20多个，共350多种衍生产品，仅Philips就有近100种。现在几乎每个半导体制造商都生产嵌入式处理器，越来越多的公司有自己的处理器设计部门。

​		嵌入式处理器的寻址空间一般从64kB到16MB，处理速度为0.1~2000MIPS，常用封装8~144个引脚。

　　根据现状，嵌入式计算机可分成下面几类。

1. 嵌入式微处理器(Embedded Microprocessor Unit, EMPU)

   ​		嵌入式微处理器采用“增强型”通用微处理器。由于嵌入式系统通常应用于环境比较恶劣的环境中，因而嵌入式微处理器在工作温度、电磁兼容性以及可靠性方面的要求较通用的标准微处理器高。但是，嵌入式微处理器在功能方面与标准的微处理器基本上是一样的。根据实际嵌入式应用要求，将嵌入式微处理器装配在专门设计的主板上，只保留和嵌入式应用有关的主板功能，这样可以大幅度减小系统的体积和功耗。

   ​		和工业控制计算机相比，嵌入式微处理器组成的系统具有体积小、重量轻、成本低、可靠性高的优点，但在其电路板上必须包括ROM、RAM、总线接口、各种外设等器件，从而降低了系统的可靠性，技术保密性也较差。由嵌入式微处理器及其存储器、总线、外设等安装在一块电路主板上构成一个通常所说的**单板机系统**。

   ​		嵌入式处理器目前主要有Am186/88、386EX、SC-400、Power PC、68000、MIPS、ARM系列等。 

2. 嵌入式微控制器(Microcontroller Unit, MCU)

   ​		嵌入式微控制器又称单片机，它将整个计算机系统集成到**一块芯片**中。嵌入式微控制器一般以某种微处理器内核为核心，根据某些典型的应用，在芯片内部集成了ROM/EPROM、RAM、总线、总线逻辑、定时/计数器、看门狗、I/O、串行口、脉宽调制输出、A/D、D/A、Flash RAM、EEPROM等各种必要功能部件和外设。

   ​		为适应不同的应用需求，对功能的设置和外设的配置进行必要的修改和裁减定制，使得一个系列的单片机具有多种衍生产品，每种衍生产品的处理器内核都相同，不同的是存储器和外设的配置及功能的设置。这样可以使单片机最大限度地和应用需求相匹配，从而减少整个系统的功耗和成本。

   ​		和嵌入式微处理器相比，微控制器的单片化使应用系统的体积大大减小，从而使功耗和成本大幅度下降、可靠性提高。由于嵌入式微控制器目前在产品的品种和数量上是所有种类嵌入式处理器中最多的，而且上述诸多优点决定了微控制器是嵌入式系统应用的主流。微控制器的片上外设资源一般比较丰富，适合于控制，因此称为微控制器。

   ​		目前MCU约占嵌入式系统市场份额的70%。

   ​		通常，嵌入式微处理器可分为通用和半通用两类：

   - 比较有代表性的通用系列包括8051、P51XA、MCS-251、MCS-96/196/296、C166/167、68300等

   - 比较有代表性的半通用系列，如支持USB接口的MCU 8XC930/931、C540、C541；支持I2C、CAN总线、LCD等的众多专用MCU和兼容系列。 

3. 嵌入式DSP处理器(Embedded Digital Signal Processor, EDSP)

   ​		在数字信号处理应用中，各种数字信号处理算法相当复杂，这些算法的复杂度可能是O (nm)的，甚至是NP的，一般结构的处理器无法实时的完成这些运算。由于DSP处理器对系统结构和指令进行了特殊设计，使其适合于实时地进行数字信号处理。在数字滤波、FFT、谱 分析等方面，DSP算法正大量进入嵌入式领域，DSP应用正从在通用单片机中以普通指令实 现DSP功能，过渡到采用嵌入式DSP处理器。

   ​		嵌入式DSP处理器有两类：

   ​		(1) DSP处理器经过单片化、EMC改造、增加片上外设成为嵌入式DSP处理器，TI的TMS320C2000/C5000等属于此范畴；

   ​		(2) 在通用单片机或SOC中增加DSP协处理器，例如Intel的MCS-296和Infineon (Siemens)的TriCore。

   ​		另外，在有关智能方面的应用中，也需要嵌入式DPS处理器，例如各种带有智能逻辑的消费类产品，生物信息识别终端，带有加解密算法的键盘，ADSL接入、 实时语音压解系统，虚拟现实显示等。这类智能化算法一般都是运算量较大，特别是**向量运算、指针线性寻址**等较多，而这些正是DSP处理器的优势所在。

   ​		嵌入式DSP处理器比较有代表性的产品是TI的TMS320系列和Motorola的DSP56000系列。TMS320系列处理器包括用于 控制的C2000系列、移动通信的C5000系列，以及性能更高的C6000和C8000系列。DSP56000 目前已经发展成为DSP56000、DSP56100、DSP56200和DSP56300等几个不同系列的处理器。 

   ​		Philips公司最近也推出了基于可重置嵌入式DSP结构，采用低成本、低功耗技术制造的R. E. A. L DSP处理器，其特点是具备双Harvard结构和双乘/累加单元，应用目标是 大批量消费类产品。

4. 嵌入式片上系统(System On Chip, SOC) 

   ​		随着EDI的推广和VLSI设计的普及化，以及半导体工艺的迅速发展，可以在一块硅片上实现一个更为复杂的系统，这就产生了SOC技术。

   ​		各种通用处理器内核将作为SOC设计公司的标准库，和其他许多嵌入式系统外设一样，成为VLSI设计中一种标准的器件，用标准的VHDL、Verlog等硬件语言描述，存储在器件库中。用户只需定义出其整个应用系统，仿真通过后就可以将设计图交给半导体工厂制作样品。这样除某些无法集成的器件以外，整个嵌入式系统大部分均可集成到一块或几块芯片中去，应用系统电路板将变得很简单，对于减小整个应用系统体积和功耗、提高可靠性非常有利。

   ​		SOC可分为通用和专用两类，通用SOC如Infineon(Siemens)的TriCore、Motorola的M-Core，以及某些ARM系列器件，如Echelon和Motorola联合研制的Neuron芯片等；专用SOC一般专用于某个或某类系统中，如Philips的Smart XA，它将XA单片机内核和支持超过2048位复杂RSA算法的CCU单元制作在一块硅片上，形成一个可加载Java或C语言的专用SOC，可用于互联网安全方面。 

## 嵌入式操作系统

​		概念：顾名思义，用于嵌入式系统的操作系统。具有[通用操作系统](obsidian://open?vault=haohao3308%E7%9A%84%E7%AC%94%E8%AE%B0%E6%9C%AC&file=%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91%E5%AD%A6%E4%B9%A0%2F%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86)的基本特点，又具有系统实时性、硬件的相关依赖性、软件固态化以及应用的专用性等特点。

​		嵌入式操作系统通常包括与硬件相关的底层驱动协议、系统内核、设备  驱动接口、通信协议、图形界面、标准化浏览器BrowSer等。

​		嵌入式操作系统具有通用操作系统的基本特点：

- 能够有效管理越来越复杂的系统资源；
- **能够把硬件虚拟化，使得开发人员从繁忙的驱动程序移植和维护中解脱出来；**
- 能够提供库函数、驱动程序、工具集以及应用程序 。

​		与通用操作系统相比较，嵌入式操作系统在系统实时高效性、**硬件的相关依赖性**、**软件固态化**以及**应用的专用性**等方面具有较为突出的特点。  

​		一般情况下，嵌入式操作系统可以分为两类：

- 面向控制、通信等领域的**实时操作系统**，如WindRiver公司的VxWorks、ISI的pSOS、QNX系统软件公司的QNX、ATI的Nucleus等；
- 面向消费电子产品的**非实时操作系统**，这类产品包括个人数字助理(PDA)、移动电话、机顶盒、电子书、WebPhone等。

### **非实时操作系统**

　　早期的嵌入式系统中没有操作系统的概念，程序员编写嵌入式程序通常直接面对裸机及裸设备。在这种情况下，通常把嵌入式程序分成两部分，即**前台程序**和**后台程序**。

​		前台程序通过中段来处理事件，其结构一般为无限循环；后台程序则掌管整个嵌入式系统软、硬件资源的分配、管理以及任务的调度，是一个系统管理调度程序。这就是通常所说的前后台系统。

​		一般情况下，后台程序也叫任务级程序，前台程序也叫事件处理级程序。在程序运行时，后台程序检查每个任务是否具备运行条件，通过一定的调度算法来完成相应的操作。**对于实时性要求特别严格的操作通常由[中断](obsidian://open?vault=haohao3308%E7%9A%84%E7%AC%94%E8%AE%B0%E6%9C%AC&file=%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91%E5%AD%A6%E4%B9%A0%2F%E4%B8%AD%E6%96%AD%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E7%82%B9)来完成**，仅在中断服务程序中标记事件的发生，不再做任何工作就退出中断，经过后台程序的调度，转由前台程序完成事件的处理，这样就不会造成在中断服务程序中处理费时的事件而影响后续和其他中断。

　　实际上，前后台系统的实时性比预计的要差。这是因为前后台系统认为所有的任务具有相同的优先级别，即是平等的，而且任务的执行又是通过FIFO队列排队，因而对那些实时性要求高的任务不可能立刻得到处理。另外，由于前台程序是一个无限循环的结构，一旦在这个循环体中正在处理的任务崩溃，使得整个任务队列中的其他任务得不到机会被处理，从而造成整个系统的崩溃。由于这类系统结构简单，几乎不需要RAM/ROM的额外开销，因而在简单的嵌入式应用被广泛使用。

### **实时操作系统**

​		实时系统是指能在确定的时间内执行其功能并对外部的异步事件做出响应的计算机系统。其操作的正确性不仅依赖于逻辑设计的正确程度，而且与这些操作进行的时间有关。“在确定的时间内”是该定义的核心。也就是说，实时系统是对响应时间有严格要求的。实时系统对逻辑和时序的要求非常严格，如果逻辑和时序出现偏差将会引起严重后果。

​		实时系统有两种类型：软实时系统和硬实时系统。软实时系统仅要求事件响应是实时的，并不要求限定某一任务必须在多长时间内完成；而在硬实时系统中，不仅要求任务响应要实时，而且要求在规定的时间内完成事件的处理。通常，大多数实时系统是两者的结合。实时应用软件的设计一般比非实时应用软件的设计困难。实时系统的技术关键是如何保证系统的实时性。实时多任务操作系统是指具有实时性、能支持实时控制系统工作的操作系统。其首要任务是调度一切可利用的资源完成实时控制任务，其次才着眼于提高计算机系统的使用效率，重要特点是要满足对时间的限制和要求。

​		实时操作系统具有如下功能：任务管理(多任务和基于优先级的任务调度)、任务间同步和通信(信号量和邮箱等)、存储器优化管理(含ROM的管理)、实时时钟服务、中断管理服务。实时操作系统具有如下特点：规模小，中断被屏蔽的时间很短，中断处理时间短，任务切换很快。

​		实时操作系统可分为可抢占型和不可抢占型两类。对于基于优先级的系统而言，可抢占型实时操作系统是指内核可以抢占正在运行任务的CPU使用权并将使用权交给进入就绪态的优先级更高的任务，是内核抢了CPU让别的任务运行。不可抢占型实时操作系统使用某种算法并决定让某个任务运行后，就把CPU的控制权完全交给了该任务，直到它主动将CPU控制权还回来。中断由中断服务程序来处理，可以激活一个休眠态的任务，使之进入就绪态；而这个进入就绪态的任务还不能运行，一直要等到当前运行的任务主动交出CPU的控制权。

​		使用这种实时操作系统的实时性比不使用实时操作系统的系统性能好，其实时性取决于最长任务的执行时间。不可抢占型实时操作系统的缺点也恰恰是这一点，如果最长任务的执行时间不能确定，系统的实时性就不能确定。可抢占型实时操作系统的实时性好，优先级高的任务只要具备了运行的条件，或者说进入了就绪态，就可以立即运行。也就是说，除了优先级最高的任务，其他任务在运行过程中都可能随时被比它优先级高的任务中断，让后者运行。通过这种方式的任务调度保证了系统的实时性，但是，如果任务之间抢占CPU控制权处理不好，会产生系统崩溃、死机等严重后果。



### 操作系统存储管理方案

#### 1.操作系统存储管理方案
![image-20221004184225490](image/%E3%80%8A%E5%B5%8C%E5%85%A5%E5%BC%8F%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E3%80%8B%27s%20Image/image-20221004184225490.png)

#### 2.MMU — 内存管理单元

​		MMU是Memory Management Unit的缩写，中文名是内存管理单元，用来管理虚拟内存的器件。MMU通常是CPU的一部分，本身有少量存储空间存放从虚拟地址到物理地址的匹配表。此表称作TLB(转换旁置缓冲区)。所有的数据请求都送往MMU,由MMU决定数据在RAM内还是在大容量存储器设备内。如果数据不在存储空间内，MMU将产生页面错误中断。		

​		MMU的两个主要功能是：

- 将虚拟地址转换成物理地址
- 控制存储器存储允许。当MMU关闭时，虚拟地址直接输出到物理地址总线。

#### 3.嵌入式系统存储管理

在有些嵌入式系统中，为了性能和价格等因素，没有配备MMU，甚至根本就不提供存储管理功能，用户程序和操作系统内核共享同一个地址空间。

# 嵌入式系统硬件和软件基础

## 嵌入式硬件系统基本组成

-   嵌入式系统的硬件是以嵌入式微处理器为核心，主要由嵌入式微处理器、总线、存储器、输入/输出接口和设备组成。
-   嵌入式系统的大多数输入/输出接口和部分设备已经集成在嵌入式微处理器中。

### 嵌入式微处理器
嵌入式微处理器体系结构：  
传统的微处理器采用的`冯·诺依曼结构`将指令和数据存放在同一存储空间中，统一编址，指令和数据通过同一总线访问。  
`哈佛结构`则是不同于冯·诺依曼结构的一种并行体系结构，其主要特点是程序和数据存储在不同的存储空间中，即程序存储器和数据存储器是两个相互独立的存储器，每个存储器独立编制、独立访问。与之相对应的是系统中设置的两条总线（程序总线和数据总线），从而使数据的吞吐率提高了一倍。

![在这里插入图片描述](image/%E3%80%8A%E5%B5%8C%E5%85%A5%E5%BC%8F%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E3%80%8B%27s%20Image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9nb25nc2lyLmJsb2cuY3Nkbi5uZXQ=,size_16,color_FFFFFF,t_70.png)

嵌入式微处理器分类：

-   按位数可分为4、8、16、32、64位
-   按用途来分，嵌入式微处理器可分为嵌入式DSP和通用的嵌入式微处理器两种：
    -   嵌入式DSP：专用于数字信号处理，采用哈佛结构，程序和数据分开存储，采用一系列措施保证数字信号的处理速度，如对FFT（快速傅立叶变换）的专门优化。
    -   通用的嵌入式微处理器：一般是集成了通用微处理器的核、总线、口和设备的SOC芯片，有些还将DSP作为协处理器集成。

### 嵌入式系统总线

![在这里插入图片描述](image/%E3%80%8A%E5%B5%8C%E5%85%A5%E5%BC%8F%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E3%80%8B%27s%20Image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9nb25nc2lyLmJsb2cuY3Nkbi5uZXQ=,size_16,color_FFFFFF,t_70-166487930069610.png)

### 嵌入式系统存储结构

存储结构：  
![在这里插入图片描述](https://img-blog.csdnimg.cn/2020010215463096.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9nb25nc2lyLmJsb2cuY3Nkbi5uZXQ=,size_16,color_FFFFFF,t_70)

## 嵌入式软件体系结构

1、软件(software)是计算机系统中与硬件(hardware)相互依存的另一部分，它包括程序(program)、相关数据(data)及其说明文档(document)。 其中：

-   程序是按照事先设计的功能和性能要求执行的指令序列；
-   数据是程序能正常操作信息的数据结构；
-   文档是与程序开发、维护、使用相关的各种图文资料。

2、嵌入式软件的特点：

1.  规模小，开发难度大；
2.  快速启动，直接运行；
3.  实时性和可靠性要求高；
4.  程序一体化；
5.  两个平台，交叉开发

3、嵌入式软件分类：

![image-20221004183213022](image/%E3%80%8A%E5%B5%8C%E5%85%A5%E5%BC%8F%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E3%80%8B%27s%20Image/image-20221004183213022.png)

4、嵌入式软件体系结构图  
![在这里插入图片描述](image/%E3%80%8A%E5%B5%8C%E5%85%A5%E5%BC%8F%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E3%80%8B%27s%20Image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9nb25nc2lyLmJsb2cuY3Nkbi5uZXQ=,size_16,color_FFFFFF,t_70-166487956111712.png)

## 嵌入式操作系统体系结构

-   嵌入式操作系统体系结构：体系结构是操作系统的基础，它定义了硬件与软件的界限、内核与操作系统其它组件（文件、网络、GUI等）的组织关系、系统与应用的接口。
-   体系结构是确保系统的性能、可靠性、灵活性、可移植性、可扩展性的关键
-   体系结构分类：单块结构、层次结构和客户/服务器（微内核）结构
-   目前嵌入式操作系统主要采用分层和模块化相结合的结构或微内核结构。

层次+模块结构：  
![在这里插入图片描述](image/%E3%80%8A%E5%B5%8C%E5%85%A5%E5%BC%8F%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E3%80%8B%27s%20Image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9nb25nc2lyLmJsb2cuY3Nkbi5uZXQ=,size_16,color_FFFFFF,t_70-166487960177514.png)

